// encoding: utf-8
// jQuery.fn.jsincludes 1.0 - MIT/GPL Licensed - More info: http://github.com/maranomynet/jsincludes/
(function(d){var j='jsincludes',i='virtualBrowser',x=function(e,a){if(a.isFirst){d(this).remove()[i]('disengage')}},y=function(e,a){var c=d(this),g=c.data(i).cfg,b=a.resultDOM;if(g.disengage){c.before(b).detach();setTimeout(function(){d('<div/>').append(c).empty()},999)}if(g.setFocus&&d.setFocus){b.setFocus()}},n=function(e){var a=d(this),c=a.data(j),g=c.vb,b=c.link,f=b[0].href.split('#')[1],h=g.data(i).cfg;h.selector=b.attr('data-selectors')||(f&&'#'+f)||h.selector;if(e){h.setFocus=1}c.vb.replaceAll(a)[i]('load',b);e&&e.preventDefault()},r,s=function(e){clearTimeout(r);r=setTimeout(function(){t()},o.refresh)},m,u,k=[],t=function(e){e=e||[];m=m||d(window);var a=m.scrollTop()+m.height();if(e.length||a!=u){k.push.apply(k,e);var c=k.length,g=c-(e.length||c),b,f,h=[];while(c-->g){b=d(k[c]);f=b.data(j).vb.data(i).cfg;if(b.offset().top<a+(f.unseenBuffer||0)){n.call(b[0]);k.splice(c,1)}}u=a}},z,o=d.fn[j]=function(p){if(p=='refresh'){s()}else{var q=[],v=[],w=[];this.each(function(){var b=d(this),f=d.extend(new l(),l,p,{url:null});if(!b.data(j)){var h=b.is('a')?b:b.find('a').not(f.noIncl);h.each(function(){var e=d(this),a=b;if(h.length>1){f=d.extend(new l(),l,p);e.insertBefore(a).addClass(a.attr('class'));a=e}var c=d('<div/>').bind('VBerror',x).one('VBloaded',y)[i](f),g={elm:a,link:e,vb:c};v.push(c[0]);a.add(c).data(j,g);if(a.is(f.lazyLoad||'')){w.push(a[0]);a.bind('click',n)}else if(!f.delayUnseen||a.is(f.forceLoad)){setTimeout(function(){n.call(a[0])},0)}else{q.push(a[0])}});if(h.length>1){b.remove()}}});if(q.length){setTimeout(function(){t(q)},0);d(window).bind('resize scroll',s)}}return{vbBodies:d(v),lazyElms:d(w)}},l=o.config=function(){};l.prototype={lazyLoad:'.lazyload',noIncl:'.no-include',loadingClass:'jsi-loading',unseenBuffer:100,forceLoad:'.forceload',disengage:true};o.refresh=100})(jQuery);
