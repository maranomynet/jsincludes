// encoding: utf-8
// jQuery.fn.jsincludes 1.0 - MIT/GPL Licensed - More info: http://github.com/maranomynet/jsincludes/
(function(d){var i='jsincludes',l='virtualBrowser',x=function(e,a){if(a.isFirst){d(this).remove()[l]('disengage')}},y=function(e,a){var b=d(this),g=b.data(l).cfg,c=a.resultDOM;if(g.disengage){b.before(c).detach();setTimeout(function(){d('<div/>').append(b).empty()},999)}if(g.setFocus&&d.setFocus){c.setFocus()}},n=function(e){var a=d(this),b=a.data(i),g=b.vb,c=b.link,f=b.cfg,h=c[0].href.split('#')[1];f.selector=(h&&'#'+h)||c.attr('data-selectors')||f.selector;if(e){f.setFocus=1}b.vb.replaceAll(a)[l]('load',c);e&&e.preventDefault()},r,s=function(e){clearTimeout(r);r=setTimeout(function(){t()},o.refresh)},m,u,j=[],t=function(e){e=e||[];m=m||d(window);var a=m.scrollTop()+m.height();if(e.length||a!=u){j.push.apply(j,e);var b=j.length,g=b-(e.length||b),c,f=[];while(b-->g){c=d(j[b]);if(c.offset().top<a+(c.data(i).cfg.unseenBuffer||0)){n.call(c[0]);j.splice(b,1)}}u=a}},z,o=d.fn[i]=function(p){if(p=='refresh'){s()}else{var q=[],v=[],w=[];this.each(function(){var c=d(this),f=d.extend(new k(),k,p,{url:null});if(!c.data(i)){var h=c.is('a')?c:c.find('a').not(f.noIncl);h.each(function(){var e=d(this),a=c;if(h.length>1){f=d.extend(new k(),k,p);e.insertBefore(a).addClass(a.attr('class'));a=e}var b=d('<div/>').bind('VBerror',x).one('VBloaded',y)[l](f),g={elm:a,link:e,vb:b,cfg:f};v.push(b[0]);a.add(b).data(i,g);if(a.is(f.lazyLoad||'')){w.push(a[0]);a.bind('click',n)}else if(!f.delayUnseen||a.is(f.forceLoad)){setTimeout(function(){n.call(a[0])},0)}else{q.push(a[0])}});if(h.length>1){c.remove()}}});if(q.length){setTimeout(function(){t(q)},0);d(window).bind('resize scroll',s)}}return{vbBodies:d(v),lazyElms:d(w)}},k=o.config=function(){};k.prototype={lazyLoad:'.lazyload',noIncl:'.no-include',loadingClass:'jsi-loading',unseenBuffer:100,forceLoad:'.forceload',disengage:true};o.refresh=100})(jQuery);
