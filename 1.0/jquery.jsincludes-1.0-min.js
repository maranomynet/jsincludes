// jQuery.fn.jsincludes 1.0 - MIT/GPL Licensed - More info: http://github.com/maranomynet/jsincludes/
(function(e){var i="jsincludes",t="virtualBrowser",s="disengage",n,a=function(i,n){if(n.isFirst){e(this).remove()[t](s)}},o=function(i,n){var a=e(this),o=a.data(t).cfg,l=n.resultDOM;if(o[s]){a.before(l).detach();setTimeout(function(){e("<div/>").append(a).empty()},999)}if(o.setFocus&&e.setFocus){l.setFocus()}},l=function(a){var o=e(this),l=o.data(i);if(l){var r=l.link,f=l.vb.data(t).cfg,c=r[0].href.split("#")[1],d=f.selector;f.selector=r.attr("data-selectors")||c&&"#"+c||d;if(a!==n){u.splice(e.inArray(o[0],u),1);if(a.target&&f.setFocus!==false){f.setFocus=1;a.preventDefault()}}l.vb.addClass(f.loadingClass).replaceAll(o)[t]("load",r);if(!f[s]){l.vb.one("VBloaded",function(){l.vb.removeClass(f.loadingClass);f.selector=d})}}},r,f=function(){clearTimeout(r);r=setTimeout(function(){h()},v.refresh)},c,d,u=[],h=function(s){s=s||[];c=c||e(window);var n=c.scrollTop()+c.height();if(s.length||n!==d){u.push.apply(u,s);var a=u.length,o=a-(s.length||a),r,f;while(a-->o){r=e(u[a]);f=r.data(i).vb.data(t).cfg;if(r.offset().top<n+(f.unseenBuffer||0)){l.call(r[0]);u.splice(a,1)}}d=n}},v=e.fn[i]=function(n){if(n==="refresh"){f()}else if(n==="load"){this.each(l)}else{var r=[],c=[],d=[];this.each(function(){var f=e(this),u=e.extend(new g,g,n,{url:null});if(!f.data(i)){var h=f.is("a")?f:f.find("a").not(u.noIncl);h.each(function(){var v=e(this),p=f;if(h.length>1){u=e.extend(new g,g,n);v.insertBefore(p).addClass(p.attr("class"));p=v}if(!p.is(u.recurse)){u[s]=true}var b=e("<div/>").bind("VBerror",a).one("VBloaded",o)[t](u),m={elm:p,link:v,vb:b};c.push(b[0]);p.add(b).data(i,m);if(p.is(u.lazyLoad||"")){d.push(p[0]);p.bind("click",l)}else if(!u.delayUnseen||p.is(u.forceLoad)){setTimeout(function(){l.call(p[0])},0)}else{r.push(p[0])}});if(h.length>1){f.remove()}}});if(r.length){setTimeout(function(){h(r)},0);e(window).bind("resize scroll",f)}return{vbBodies:e(c),lazyElms:e(d)}}return this},g=v.config=function(){};g.prototype={lazyLoad:".lazyload",noIncl:".no-include",loadingClass:"jsi-loading",unseenBuffer:100,forceLoad:".forceload",recurse:""};v.refresh=100})(jQuery);
